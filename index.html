<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>حاسبة الاستثمار</title>
    <style>
        :root { --primary: #27ae60; --bg: #f8fafc; --text: #334155; --border: #e2e8f0; }
        body { font-family: system-ui, -apple-system, sans-serif; background: #f0f2f5; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; color: var(--text); }
        
        .card { background: #fff; width: 880px; max-width: 98%; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); display: grid; grid-template-columns: 280px 1fr; overflow: hidden; }
        
        .inputs { padding: 20px; border-left: 1px solid var(--border); display: flex; flex-direction: column; gap: 10px; }
        h3 { margin: 0 0 5px 0; font-size: 16px; color: var(--primary); }
        
        .input-group { display: flex; flex-direction: column; gap: 3px; }
        label { font-size: 11px; font-weight: 600; color: #64748b; }
        input, select { width: 100%; padding: 6px 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px; outline: none; transition: 0.2s; background: #fff; box-sizing: border-box; }
        input:focus, select:focus { border-color: var(--primary); }
        
        .split-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }

        .duration-buttons { display: grid; grid-template-columns: repeat(4, 1fr); gap: 4px; margin-top: 5px; }
        .duration-btn { background: var(--bg); border: 1px solid var(--border); padding: 5px; border-radius: 4px; cursor: pointer; font-size: 10px; font-weight: bold; transition: 0.2s; color: #475569; }
        .duration-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        .res { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 15px; }
        .res div { background: var(--bg); padding: 10px; border-radius: 8px; text-align: center; border: 1px solid var(--border); }
        .res span { display: block; font-size: 10px; color: #64748b; }
        .res strong { display: block; font-size: 14px; color: var(--primary); margin-top: 2px; }

        .chart-area { padding: 20px 20px 50px 70px; display: flex; flex-direction: column; justify-content: center; background: #fff; }
        svg { width: 100%; height: 350px; overflow: visible; }
        .grid-line { stroke: #f1f5f9; stroke-width: 1; }
        .axis-text { fill: #94a3b8; font-size: 10px; }
        
        .legend { display: flex; justify-content: center; gap: 20px; margin-top: 15px; }
        .legend-item { display: flex; align-items: center; gap: 6px; font-size: 11px; color: #64748b; }
        .legend-dot { width: 10px; height: 3px; border-radius: 2px; }

        @media (max-width: 750px) {
            .card { grid-template-columns: 1fr; }
            .inputs { border-left: none; border-bottom: 1px solid var(--border); }
            .chart-area { padding: 20px 20px 50px 70px; }
        }
    </style>
</head>
<body>

<div class="card">
    <div class="inputs">
        <h3>البيانات المالية</h3>
        
        <div class="input-group">
            <label>رأس المال الأولي</label>
            <input type="number" id="init" value="10000" oninput="calc()">
        </div>

        <div class="input-group">
            <label>الادخار الشهري</label>
            <input type="number" id="m" value="2000" oninput="calc()">
        </div>
        
        <div class="split-row">
            <div class="input-group">
                <label>العائد %</label>
                <input type="number" id="r" value="10" oninput="calc()">
            </div>
            <div class="input-group">
                <label>نوع التركيب</label>
                <select id="compound" onchange="calc()">
                    <option value="12">شهري</option>
                    <option value="4">ربع سنوي</option>
                    <option value="2">نصف سنوي</option>
                    <option value="1">سنوي</option>
                </select>
            </div>
        </div>

        <div class="split-row">
            <div class="input-group">
                <label>التضخم %</label>
                <input type="number" id="f" value="3" oninput="calc()">
            </div>
            <div class="input-group">
                <label>السنوات</label>
                <input type="number" id="y" value="25" oninput="calc()">
            </div>
        </div>

        <div class="duration-buttons">
            <button class="duration-btn" onclick="setYears(10, this)">10س</button>
            <button class="duration-btn" onclick="setYears(20, this)">20س</button>
            <button class="duration-btn active" onclick="setYears(25, this)">25س</button>
            <button class="duration-btn" onclick="setYears(30, this)">30س</button>
        </div>

        <div class="res">
            <div><span>الرصيد النهائي</span><strong id="n">0</strong></div>
            <div style="background: #f0fdf4;"><span>القوة الشرائية</span><strong id="p">0</strong></div>
        </div>
    </div>

    <div class="chart-area">
        <svg id="svg" viewBox="-60 0 520 350"> 
            <g id="gLines"></g>
            <path id="pathN" fill="none" stroke="#cbd5e1" stroke-width="1.5" stroke-dasharray="4" />
            <path id="pathR" fill="rgba(39, 174, 96, 0.08)" stroke="#27ae60" stroke-width="3" />
            <g id="gLabels"></g>
        </svg>
        <div class="legend">
            <div class="legend-item"><div class="legend-dot" style="background:#cbd5e1;"></div> الرصيد الاسمي</div>
            <div class="legend-item"><div class="legend-dot" style="background:#27ae60;"></div> القوة الشرائية</div>
        </div>
    </div>
</div>

<script>
const CHART_HEIGHT = 300; 
const CHART_WIDTH = 450; 

function setYears(y, btn) {
    document.getElementById('y').value = y;
    document.querySelectorAll('.duration-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    calc();
}

function calc() {
    const initCapital = parseFloat(document.getElementById('init').value) || 0;
    const P = parseFloat(document.getElementById('m').value) || 0;
    const rAnn = parseFloat(document.getElementById('r').value) / 100;
    const fAnn = parseFloat(document.getElementById('f').value) / 100;
    const years = parseInt(document.getElementById('y').value) || 1;
    const n = parseInt(document.getElementById('compound').value);

    let ptsN = [], ptsR = [];
    const rateM = Math.pow(1 + rAnn/n, n/12) - 1;
    const rRealAnn = ((1 + rAnn) / (1 + fAnn)) - 1;
    const rateRealM = Math.pow(1 + rRealAnn/n, n/12) - 1;

    for (let i = 0; i <= years; i++) {
        let months = i * 12;
        let vN = initCapital * Math.pow(1 + rateM, months) + (months > 0 ? P * ((Math.pow(1 + rateM, months) - 1) / rateM) : 0);
        let vR = initCapital * Math.pow(1 + rateRealM, months) + (months > 0 ? P * ((Math.pow(1 + rateRealM, months) - 1) / rateRealM) : 0);
        ptsN.push(vN);
        ptsR.push(vR);
    }

    const max = Math.max(...ptsN, 100) * 1.1;
    document.getElementById('n').innerText = Math.round(ptsN[years]).toLocaleString();
    document.getElementById('p').innerText = Math.round(ptsR[years]).toLocaleString();
    updateUI(ptsN, ptsR, years, max);
}

function updateUI(ptsN, ptsR, Y, max) {
    const gLines = document.getElementById('gLines');
    const gLabels = document.getElementById('gLabels');
    gLines.innerHTML = ''; gLabels.innerHTML = '';

    for(let i=0; i<=4; i++) {
        let y = CHART_HEIGHT - (i * (CHART_HEIGHT / 4)); 
        let val = (max / 4) * i;
        gLines.innerHTML += `<line class="grid-line" x1="0" y1="${y}" x2="${CHART_WIDTH}" y2="${y}" />`;
        let labelText = val >= 1000000 ? (val/1000000).toFixed(1)+'M' : (val/1000).toFixed(0)+'k';
        /* التعديل: استخدام x=-35 و text-anchor: middle لتوسيط الأرقام في الفراغ المخصص لها */
        gLabels.innerHTML += `<text x="-35" y="${y+4}" text-anchor="middle" class="axis-text">${labelText}</text>`;
    }

    let step = Math.max(1, Math.ceil(Y / 5));
    for(let i=0; i<=Y; i+=step) {
        let x = (i / Y) * CHART_WIDTH;
        gLines.innerHTML += `<line class="grid-line" x1="${x}" y1="0" x2="${x}" y2="${CHART_HEIGHT}" />`;
        gLabels.innerHTML += `<text x="${x}" y="${CHART_HEIGHT + 25}" text-anchor="middle" class="axis-text">${i}س</text>`;
    }

    const getD = (data) => data.map((v, i) => `${i?'L':'M'} ${(i/Y)*CHART_WIDTH} ${CHART_HEIGHT-(v/max)*CHART_HEIGHT}`).join(' ');
    document.getElementById('pathN').setAttribute("d", getD(ptsN));
    document.getElementById('pathR').setAttribute("d", getD(ptsR) + ` L ${CHART_WIDTH} ${CHART_HEIGHT} L 0 ${CHART_HEIGHT} Z`);
}

window.onload = calc;
</script>
</body>
</html>
